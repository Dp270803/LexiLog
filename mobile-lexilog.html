<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LexiLog - Mobile Optimized</title>
    
    <style>
        /* Mobile-first CSS with embedded styles */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px 10px;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            color: #333;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .search-box {
            margin-bottom: 20px;
        }
        
        .search-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 15px;
            font-size: 16px;
            margin-bottom: 10px;
        }
        
        .search-button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .search-button:active {
            transform: scale(0.98);
        }
        
        .result-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-left: 5px solid #667eea;
        }
        
        .word-title {
            font-size: 1.8rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        
        .phonetic {
            color: #666;
            font-style: italic;
            margin-bottom: 15px;
        }
        
        .definition {
            color: #333;
            line-height: 1.6;
            margin-bottom: 15px;
        }
        
        .save-button {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 14px;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .suggestions {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .suggestion-button {
            display: block;
            width: 100%;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 12px;
            margin: 5px 0;
            border-radius: 10px;
            text-align: left;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .suggestion-button:hover {
            background: #e9ecef;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin-top: 20px;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        
        .back-button {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 14px;
            cursor: pointer;
            margin-bottom: 20px;
        }
        
        .home-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 15px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 20px;
            width: 100%;
        }
    </style>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìö LexiLog</h1>
            <p>Smart Dictionary with Spell Check</p>
        </div>
        
        <div class="search-box">
            <input type="text" id="searchInput" class="search-input" placeholder="Enter any word..." />
            <button onclick="searchWord()" class="search-button">üîç Search & Spell Check</button>
        </div>
        
        <div id="results"></div>
        
        <button onclick="goHome()" class="home-button">üè† Back to Main Site</button>
    </div>

    <script>
        // Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyByQABCkc1kQgSZevk30UKWQe3dq0bhHbs",
            authDomain: "lexilog-c1559.firebaseapp.com",
            projectId: "lexilog-c1559",
            storageBucket: "lexilog-c1559.firebasestorage.app",
            messagingSenderId: "383823777893",
            appId: "1:383823777893:web:ffe084adfbf2d1ee7cf68c",
            measurementId: "G-QXMEFRQ36N"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        let currentUser = null;
        
        // Common misspellings dictionary
        const misspellings = {
            'recieve': 'receive', 'seperate': 'separate', 'definately': 'definitely',
            'occassion': 'occasion', 'accomodate': 'accommodate', 'begining': 'beginning',
            'beleive': 'believe', 'calender': 'calendar', 'collegue': 'colleague',
            'concious': 'conscious', 'embarass': 'embarrass', 'enviroment': 'environment',
            'existance': 'existence', 'foward': 'forward', 'freind': 'friend',
            'garentee': 'guarantee', 'goverment': 'government', 'grammer': 'grammar',
            'happend': 'happened', 'harrass': 'harass', 'immediatly': 'immediately',
            'independant': 'independent', 'knowlege': 'knowledge', 'liase': 'liaise',
            'liason': 'liaison', 'lollypop': 'lollipop', 'neccessary': 'necessary',
            'neccessity': 'necessity', 'occassionally': 'occasionally', 'occurence': 'occurrence',
            'occured': 'occurred', 'occuring': 'occurring', 'pavillion': 'pavilion',
            'peice': 'piece', 'persistant': 'persistent', 'pharoah': 'pharaoh',
            'peom': 'poem', 'posession': 'possession', 'prefered': 'preferred',
            'priviledge': 'privilege', 'probaly': 'probably', 'proffesional': 'professional',
            'promiss': 'promise', 'pronounciation': 'pronunciation', 'prufe': 'proof',
            'publically': 'publicly', 'quater': 'quarter', 'que': 'queue',
            'questionaire': 'questionnaire', 'readible': 'readable', 'realy': 'really',
            'reccomend': 'recommend', 'rediculous': 'ridiculous', 'refered': 'referred',
            'refering': 'referring', 'religous': 'religious', 'rember': 'remember',
            'remberance': 'remembrance', 'resistence': 'resistance', 'sence': 'sense',
            'sieze': 'seize', 'similiar': 'similar', 'sincerly': 'sincerely',
            'speach': 'speech', 'sucess': 'success', 'sucessful': 'successful',
            'sucessfully': 'successfully', 'sucessor': 'successor', 'surelly': 'surely',
            'surprize': 'surprise', 'tatoo': 'tattoo', 'tendancy': 'tendency',
            'therefor': 'therefore', 'threshhold': 'threshold', 'tommorow': 'tomorrow',
            'tounge': 'tongue', 'truely': 'truly', 'unfortunatly': 'unfortunately',
            'untill': 'until', 'wierd': 'weird', 'whereever': 'wherever',
            'wich': 'which', 'womens': 'women\'s', 'youre': 'you\'re'
        };
        
        async function searchWord() {
            const word = document.getElementById('searchInput').value.trim();
            if (!word) return;
            
            showLoading();
            
            try {
                // First try the exact word
                const response = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${encodeURIComponent(word)}`);
                
                if (response.ok) {
                    const data = await response.json();
                    if (data && data.length > 0) {
                        displayResult(data[0]);
                        return;
                    }
                }
                
                // Word not found, try spell checking
                const suggestions = await getSpellSuggestions(word);
                if (suggestions.length > 0) {
                    displaySuggestions(word, suggestions);
                } else {
                    showError('Word not found and no suggestions available.');
                }
                
            } catch (error) {
                console.error('Search error:', error);
                showError('Search failed. Please try again.');
            }
        }
        
        async function getSpellSuggestions(word) {
            const suggestions = [];
            
            // Check common misspellings
            const correction = misspellings[word.toLowerCase()];
            if (correction) {
                suggestions.push(correction);
            }
            
            // Try API-based suggestions
            try {
                const response = await fetch(`https://api.datamuse.com/words?sp=${word}&max=5`);
                if (response.ok) {
                    const data = await response.json();
                    suggestions.push(...data.map(item => item.word));
                }
            } catch (error) {
                console.error('API spell check error:', error);
            }
            
            // Remove duplicates and verify suggestions exist
            const uniqueSuggestions = [...new Set(suggestions)];
            const verifiedSuggestions = [];
            
            for (const suggestion of uniqueSuggestions.slice(0, 5)) {
                try {
                    const response = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${encodeURIComponent(suggestion)}`);
                    if (response.ok) {
                        verifiedSuggestions.push(suggestion);
                    }
                } catch (error) {
                    // Skip this suggestion
                }
            }
            
            return verifiedSuggestions;
        }
        
        function displayResult(wordData) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `
                <div class="result-card">
                    <div class="word-title">${wordData.word}</div>
                    ${wordData.phonetic ? `<div class="phonetic">${wordData.phonetic}</div>` : ''}
                    <div class="definition">
                        <strong>${wordData.meanings[0].partOfSpeech}:</strong> 
                        ${wordData.meanings[0].definitions[0].definition}
                    </div>
                    <button onclick="saveWord('${wordData.word}')" class="save-button">
                        üíæ Save to My LexiLog
                    </button>
                </div>
            `;
        }
        
        function displaySuggestions(originalWord, suggestions) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `
                <div class="suggestions">
                    <h3>Did you mean one of these words?</h3>
                    <p>We couldn't find "<strong>${originalWord}</strong>" but here are some suggestions:</p>
                    ${suggestions.map(suggestion => `
                        <button onclick="searchSuggestion('${suggestion}')" class="suggestion-button">
                            ${suggestion}
                        </button>
                    `).join('')}
                </div>
            `;
        }
        
        function searchSuggestion(word) {
            document.getElementById('searchInput').value = word;
            searchWord();
        }
        
        function showLoading() {
            document.getElementById('results').innerHTML = '<div class="loading">üîç Searching...</div>';
        }
        
        function showError(message) {
            document.getElementById('results').innerHTML = `<div class="error">‚ùå ${message}</div>`;
        }
        
        async function saveWord(word) {
            if (!currentUser) {
                alert('Please log in to save words.');
                return;
            }
            
            try {
                await db.collection('artifacts').doc('lexilog-vocabulary-builder')
                    .collection('users').doc(currentUser.uid)
                    .collection('vocabulary').doc(word.toLowerCase()).set({
                        word: word,
                        savedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                
                alert('Word saved successfully!');
            } catch (error) {
                console.error('Save error:', error);
                alert('Failed to save word.');
            }
        }
        
        function goHome() {
            window.location.href = 'https://lexilog-dp.netlify.app/';
        }
        
        // Enter key support
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchWord();
            }
        });
        
        // Check if user is logged in
        firebase.auth().onAuthStateChanged(function(user) {
            currentUser = user;
        });
    </script>
</body>
</html>
