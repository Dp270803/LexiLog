<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LexiLog Simple Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f0f0f0; }
        .container { max-width: 400px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1 { color: #3B82F6; text-align: center; margin-bottom: 30px; }
        .view { display: none; }
        .view.active { display: block; }
        input { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; margin: 10px 0; background: #3B82F6; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; }
        button:hover { background: #2563EB; }
        .link-btn { background: none; color: #3B82F6; text-decoration: underline; }
        .link-btn:hover { background: none; color: #2563EB; }
        .home { text-align: center; }
        .feature-card { background: linear-gradient(135deg, #3B82F6, #1D4ED8); color: white; padding: 20px; margin: 10px 0; border-radius: 10px; cursor: pointer; }
        .feature-card:hover { transform: translateY(-2px); }
        .logout { position: absolute; top: 10px; right: 10px; padding: 8px 16px; font-size: 14px; background: #EF4444; }
    </style>
    
    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
</head>
<body>
    <div class="container">
        <!-- Login View -->
        <div id="loginView" class="view active">
            <h1>üîë Sign In to LexiLog</h1>
            <input type="email" id="loginEmail" placeholder="Email" required>
            <input type="password" id="loginPassword" placeholder="Password" required>
            <button onclick="login()">Sign In</button>
            <button class="link-btn" onclick="showView('signup')">Don't have an account? Sign up</button>
        </div>

        <!-- Signup View -->
        <div id="signupView" class="view">
            <h1>üìù Join LexiLog</h1>
            <input type="text" id="signupName" placeholder="Full Name" required>
            <input type="email" id="signupEmail" placeholder="Email" required>
            <input type="password" id="signupPassword" placeholder="Password" required>
            <select id="signupGoal" required>
                <option value="">What are you preparing for?</option>
                <option value="cat">CAT</option>
                <option value="gre">GRE</option>
                <option value="gmat">GMAT</option>
                <option value="vocabulary-building">Just Building Vocabulary</option>
                <option value="other">Other</option>
            </select>
            <button onclick="signup()">Create Account</button>
            <button class="link-btn" onclick="showView('login')">Already have an account? Sign in</button>
        </div>

        <!-- Home View -->
        <div id="homeView" class="view">
            <button class="logout" onclick="logout()">Logout</button>
            <div class="home">
                <h1 id="greeting">Welcome to LexiLog!</h1>
                <div class="feature-card" onclick="showView('dictionary')">
                    üìö Smart Dictionary<br><small>Search English words</small>
                </div>
                <div class="feature-card" onclick="alert('Coming soon!')">
                    üìñ My Vocabulary<br><small>Your saved words</small>
                </div>
            </div>
        </div>

        <!-- Dictionary View -->
        <div id="dictionaryView" class="view">
            <button onclick="showView('home')" style="width: auto; background: #6B7280; margin-bottom: 20px;">‚Üê Back to Home</button>
            <h1>üìö Dictionary</h1>
            <input type="text" id="searchWord" placeholder="Enter English word..." onkeypress="if(event.key==='Enter') searchWord()">
            <button onclick="searchWord()">Search</button>
            <div id="searchResult" style="margin-top: 20px; padding: 15px; background: #F3F4F6; border-radius: 6px; display: none;">
                <h3 id="resultWord"></h3>
                <div id="resultDefinition"></div>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyByQABCkc1kQgSZevk30UKWQe3dq0bhHbs",
            authDomain: "lexilog-c1559.firebaseapp.com",
            projectId: "lexilog-c1559",
            storageBucket: "lexilog-c1559.firebasestorage.app",
            messagingSenderId: "383823777893",
            appId: "1:383823777893:web:ffe084adfbf2d1ee7cf68c",
            measurementId: "G-QXMEFRQ36N"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let currentUser = null;

        // View management
        function showView(viewName) {
            console.log('Showing view:', viewName);
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById(viewName + 'View').classList.add('active');
        }

        // Authentication
        auth.onAuthStateChanged(async (user) => {
            console.log('Auth state:', user ? 'logged in' : 'logged out');
            if (user) {
                currentUser = user;
                document.getElementById('greeting').textContent = `Welcome, ${user.email.split('@')[0]}!`;
                showView('home');
            } else {
                currentUser = null;
                showView('login');
            }
        });

        async function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                alert('Please fill in all fields');
                return;
            }

            try {
                await auth.signInWithEmailAndPassword(email, password);
                console.log('Login successful');
            } catch (error) {
                alert('Login failed: ' + error.message);
            }
        }

        async function signup() {
            const name = document.getElementById('signupName').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const goal = document.getElementById('signupGoal').value;
            
            if (!name || !email || !password || !goal) {
                alert('Please fill in all fields');
                return;
            }

            try {
                const result = await auth.createUserWithEmailAndPassword(email, password);
                
                // Save profile
                await db.collection('artifacts').doc('lexilog-vocabulary-builder')
                    .collection('users').doc(result.user.uid)
                    .collection('profile').doc('data').set({
                        name: name,
                        email: email,
                        goal: goal,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });

                console.log('Signup successful');
            } catch (error) {
                alert('Signup failed: ' + error.message);
            }
        }

        function logout() {
            auth.signOut();
        }

        async function searchWord() {
            const word = document.getElementById('searchWord').value.trim();
            if (!word) return;

            try {
                const response = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`);
                const data = await response.json();
                
                if (data && data[0]) {
                    document.getElementById('resultWord').textContent = data[0].word;
                    document.getElementById('resultDefinition').innerHTML = 
                        data[0].meanings[0].definitions[0].definition;
                    document.getElementById('searchResult').style.display = 'block';
                } else {
                    alert('Word not found');
                }
            } catch (error) {
                alert('Search failed');
            }
        }
    </script>
</body>
</html>
